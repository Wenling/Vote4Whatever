<!DOCTYPE html>
<html lang="en">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <link media="screen" rel="stylesheet" href="/css/bootstrap.min.css" />
            <link type="text/css" rel="stylesheet" href="/css/bootstrap-responsive.min.css" />
            <link rel="stylesheet" href="/css/docs.css" />
            <script src="http://code.jquery.com/jquery-latest.js"></script>
            <script type="text/javascript" src="/js/bootstrap.min.js"></script>
            </head>
    <body>
        <div class="navbar navbar-inverse navbar-fixed-top">
            <div class="navbar-inner">
                <a class="brand" href="#">Home</a>
                <ul class="nav">
                    <li class="active"><a href="#" class="dropdown-toggle" data-toggle="dropdown"><b>{{ username }}</b><b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li><a tabindex="-1" href="/?category=a">View My Categories</a></li>
                            <li class="divider"></li>
                            <li><a tabindex="-1" href="/?category=all">Explore All Categories</a></li>
                        </ul>
                    </li>
                    {% if username %}
                    <li><a href="/?vote_cat=all">Vote</a></li>
                    <li><a href="/?stats=all">Voting Stats</a></li>
                    {% endif %}
                    <li><a href="{{ url }}">{{ url_linktext }}</a></li>
                </ul>
            </div>
        </div>
        <header class="jumbotron subhead">
            <div class="container">
                <h2>Vote 4 Whatever <small>Vote without thinking.</small></h2>
            </div>
        </header>
        <div class="container">
            {% if vote_cat %}
            <div class="row">
                <div class="span9">
                    <table class="table table-hover" id="Vote_Categories">
                        <thead>
                            <th></th><th>Name</th><th>Owner</th><th>Create Time</th><th>Expiration Time</th>
                        </thead>
                        <!--{% if categories %}<tr><td span=4>aaa</td></tr>{% endif %} -->
                        {% for cat in vote_cat %}
                        {% if cat.name %}
                        <tr><td><a href="/?vote_cat={{ cat.name }}&owner={{cat.owner_id}}">Vote</a></td><td>{{ cat.name }}</td><td>{{ cat.owner }}</td><td>{{ cat.create_time }}</td><td>{{ cat.expiration_time }}</td></tr>
                        {% endif %}
                        {% endfor %}
                    </table>
                </div>
            </div>
            {% elif vote %}
            <div class="row">
                <div class="span8 offset1">
                    {% if prev1 %}
                    <div class="alert alert-block">
                        <center>You vote <b>{{prev1}}</b> over <b>{{prev2}} </b></center>
                    </div>
                    {% endif %}
                </div>
                <div class="span9">
                    <div class="row">
                        <div class="span1"></div>
                        <ul class="thumbnails">
                            <li class="span4" style="background-color:#f8f8f8;">
                                <div class="thumbnail">
                                    <img src="/img?img_id={{vote_key[0]}}" data-src="holder.js/300x300" alt="" style="width: 300px; height: 300px;">
                                        <div class="caption">
                                            <h3><center>{{vote[0].name}}</center></h3>
                                            <br/>
                                            <center>
                                                <a href="/vote?item_name={{vote[0].name}}&cat_name={{cat}}&owner={{owner}}&unvote_item={{vote[1].name}}" class="btn btn-primary">Vote</a>
                                                <a href="/vote?not_skip=2&skip_item={{vote[0].name}}&cat_name={{cat}}&owner={{owner}}&item={{vote[1].name}}" class="btn">Skip</a>
                                            </center>
                                        </div>
                                        </div>
                            </li>
                            <li class="span4" style="background-color:#f8f8f8;">
                                <div class="thumbnail">
                                    <img src="/img?img_id={{vote_key[1]}}" data-src="holder.js/300x300" alt="" style="width: 300px; height: 300px;">
                                        <div class="caption">
                                            <h3><center>{{vote[1].name}}</center></h3>
                                            <br/>
                                            <center>
                                                <a href="/vote?item_name={{vote[1].name}}&cat_name={{cat}}&owner={{owner}}&unvote_item={{vote[0].name}}" class="btn btn-primary">Vote</a>
                                                <a href="/vote?not_skip=1&item={{vote[0].name}}&cat_name={{cat}}&owner={{owner}}&skip_item={{vote[1].name}}" class="btn">Skip</a>
                                            </center>
                                        </div>
                                        </div>
                            </li>
                            
                        </ul>
                        
                    </div>
                </div>
                <div class="span8 offset1">
                    <div class="alert alert-block">
                        <center><h4><a href="/?stats_cat={{cat}}&owner={{owner}}">See what everyone votes</a></h4></center>
                    </div>
                </div>
            </div>
            {% elif categories %}
            <div class="row">
                {% if view==False %}
                <div class="span4">
                    <ul class="nav nav-tabs" id="myTab">
                        <li class="active"><a href="#addCat">Add a Category</a></li>
                        <li><a href="#importCat">Import a Category</a></li>
                    </ul>
                    
                    <div class="tab-content">
                        {% if upload=='fail' %}
                        <div class="alert alert-error">
                            Upload failed..
                        </div>
                        {% elif upload=='success' %}
                        <div class="alert alert-success">
                            Upload succeeded!
                        </div>'
                        {% endif %}
                        {% if add=='fail' %}
                        <div class="alert alert-error">
                            You have added this one before.
                        </div>
                        {% elif add=='success' %}
                        <div class="alert alert-success">
                            Successfully added!
                        </div>
                        {% endif %}
                        <div class="tab-pane active" id="addCat">
                            <form action="/addCat" method="post">
                                <legend>Category Name:<input type="text" name="cat_name"></legend>
                                <legend>Expiration Time: <input type="text" name="expiration_time"></legend>
                                <input class="btn btn-primary" type="submit" value="Add Category">
                                <input class="btn" type="reset" value="Reset">
                            </form>
                        </div>
                        <div class="tab-pane" id="importCat">
                            <form action={{import}} method="post" enctype="multipart/form-data">
                                <legend>Import Category directly from here: <br/><input type="file" name="cat_path"></legend>
                                <input class="btn btn-primary" type="submit" value="Add Category">
                                <input class="btn" type="reset" value="Reset">
                            </form>
                        </div>
                    </div>
                    
                    <script>
                        $('#myTab a').click(function (e) {
                                            e.preventDefault();
                                            $(this).tab('show');
                                            })
                    </script>
                                        
                </div>
                <div class="span5">
                {% else %}
                <div class = "span9">
                {% endif %}
                    <table class="table table-hover" id="Categories">
                        <thead>
                            <th></th><th>Name</th><th>Create Time</th><th>Expiration Time</th>
                        </thead>
                        <!--{% if categories %}<tr><td span=4>aaa</td></tr>{% endif %} -->
                        {% for cat in categories %}
                        {% if cat.name %}
                        <tr><td>
                            {% if view==False %}
                            <a href="/?cat_name={{cat.name}}&owner={{cat.owner_id}}">Edit</a>
                            {% else %}
                            <a href="/?cat_name={{cat.name}}&owner={{cat.owner_id}}">View</a>
                            {% endif %}
                        </td><td>{{ cat.name }}</td><td>{{ cat.create_time }}</td><td>{{ cat.expiration_time }}</td></tr>
                        {% endif %}
                        {% endfor %}
                    </table>
                </div>
            </div>
            {% elif items %}
            <div class="row">
                <div class="row">
                    <div class="span3 offset7">
                        <a class="btn btn-info"href="/export?cat_name={{cat_name}}&owner={{owner}}">Export <b>{{cat_name}}</b> as XML</a>
                    </div>
                </div>
                
                {% if owner == user_id %}
                {% if add_fail %}
                <div class="alert alert-error">
                    You have added this one before.
                </div>
                {% endif %}
                <div class="span3">
                    <form action="/addItem" method="post" class="bs-docs-example" enctype="multipart/form-data">
                        <legend>Add a new one:</legend>
                        <label>Item Name:</label><input type="text" name="item_name">
                        <label>Image: </label><input type="file" name="picture">
                        <input type="hidden" name = 'cat_name' value="{{ cat_name }}">
                        <input type="hidden" name = 'owner' value="{{ owner }}">
                        <hr>
                        <div class="controls">
                            <input class="btn btn-primary" type="submit" value="Add Item">
                            <input class="btn" type="reset" value="Reset">
                        </div>
                                    
                    </form>
                </div>
                <div class="span6">
                {% else %}
                <div class="span9">
                {% endif %}
                    <table class="table table-hover" id="Items">
                        <thead>
                            <th></th><th></th><th>Image</th><th>Name</th><th>Create Time</th>
                        </thead>
                        <!-- {% if items %}<tr><td span=4>aaa</td></tr>{% endif %} -->
                        {% for item in items %}
                        {% if item.name %}
                        <tr><td>
                            {% if user_id == owner %}
                            <a href="#{{id[item.name]}}" data-toggle="modal">Remove</a></td><td>
                                <!-- Modal -->
                                <div id="{{id[item.name]}}" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">                                                                            
                                        <div class="modal-body">
                                            <div class="alert">
                                            <p>Are you sure to delete <b>{{ item.name }}</b>?</p>
                                            </div>
                                            
                                        </div>
                                        <div class="modal-footer">
                                            <form action="/removeItem" method="post">
                                            <input type="hidden" name = 'cat_name' value="{{ cat_name }}">
                                            <input type="hidden" name = 'owner' value="{{ owner }}">
                                            <input type="hidden" name = 'item_name' value="{{ item.name }}">
                                            <button class="btn" data-dismiss="modal" aria-hidden="true">No</button>
                                            <input type="submit" value="Yes" class="btn btn-primary">
                                            </form>
                                        </div>                                   
                                </div>
                            {% endif %}
                            <a href='/?item_name={{item.name}}&owner={{owner}}&parent={{cat_name}}'>View</a>                            
                        </td><td><img src="/img?img_id={{key[item.name]}}"></img></td><td>{{ item.name }}</td><td>{{ item.create_time }}</td></tr>
                        {% endif %}
                        {% endfor %}
                    </table>
                </div>
            </div>
            {% elif item %}
            <div class="row">                
                <div class="span4">
                    <ul class="thumbnails">
                        <li class="span4"  style="background-color:#f8f8f8;">
                            <div class="thumbnail">
                                <img src="/images/ny.jpg" data-src="holder.js/300x300" alt="" style="width: 250px; height: 300px;">
                                <center>
                                    <h3>{{item.name}}</h3>
                                    <p>{{item.create_time}}</p>
                                </center>
                            </div>
                        </li>
                    </ul>                    
                </div>
                <div class="span5">
                    
                    <!-- show comments here -->
                    {% if comments %}
                    <table class="table table-hover" id="Item">
                        <!-- {% if items %}<tr><td span=4>aaa</td></tr>{% endif %} -->
                        {% for comment in comments %}
                        {% if comment.content %}
                        <tr><td><b>{{comment.commenter}}</b></td><td>{{ comment.content }}</td><td>{{ comment.create_time }}</td></tr>
                        {% endif %}
                        {% endfor %}
                    </table>
                    {% endif %}
                    {% if fail %}
                    <div class="alert alert-error">
                        You are only allowed to make one comment on every item.
                    </div>
                    {% endif %}
                    <b>Leave your thoughts here:</b>
                    <form action="/addComment" method="post">
                        <legend><textarea name="content" rows="3" cols="60"></textarea></legend>
                        <input type="hidden" name = 'owner' value="{{ owner }}">
                        <input type="hidden" name = 'cat_name' value="{{ cat_name }}">
                        <input type="hidden" name = 'item_name' value="{{ item.name }}">
                        <input class="btn btn-primary" type="submit" value="Comment">
                        <input class="btn" type="reset" value="Reset">
                                        
                    </form>
                </div>
            </div>
            {% elif results or unvoted %}
            <div class="row">
                <table class="table table-hover" id="Results">
                    <caption></caption>
                    <thead>
                        <tr><th>Name</th><th>Win</th><th>Lose</th><th>Percentage</th></tr>
                    </thead>
                    <tbody>
                        {% for name in results %}
                        {% if name %}
                        <tr>
                            <td>{{name[0]}}</td><td>{{name[1][0]}}</td><td>{{name[1][1]}}</td><td>{{name[1][2]}}</td>
                        </tr>
                        {% endif %}
                        {% endfor %}
                        
                        {% for name in unvoted %}
                        {% if unvoted[name] %}
                        <tr>
                            <td>{{name}}</td><td>{{unvoted[name][0]}}</td><td>{{unvoted[name][1]}}</td><td>{{unvoted[name][2]}}</td>
                        </tr>
                        {% endif %}
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% elif stats_cat %}
        <div class="row">
            <div class="span9">
                <table class="table table-hover" id="Category">
                    <thead>
                        <th></th><th>Name</th><th>Owner</th><th>Create Time</th><th>Expiration Time</th>
                    </thead>
                    <!--{% if categories %}<tr><td span=4>aaa</td></tr>{% endif %} -->
                    {% for cat in stats_cat %}
                    {% if cat.name %}
                    <tr><td><a href="/?stats_cat={{cat.name}}&owner={{cat.owner_id}}">See Results</a></td><td>{{ cat.name }}</td><td>{{ cat.owner }}</td><td>{{ cat.create_time }}</td><td>{{ cat.expiration_time }}</td></tr>
                    {% endif %}
                    {% endfor %}
                </table>
            </div>
        </div>
        {% else %}
        <div class="row">
            <div class="span6 offset3">
                <div class="hero-unit">
                    <h1>Vote. Simplicity.</h1>
                    <p></p>
                    <p class="alert alert-info">This function right now is unfortunately unavaible.</p>
                    {% if not username %}
                    <a class="btn btn-primary btn-large" href="{{ url }}">
                        Login
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}
        
        <footer class="footer">
            <div class="container">
                <ul class="footer-links">
                    <li><a href="http://1010ling.blogspot.com" target="_blank">Blog</a></li>
                    <li class="muted">·</li>
                    <li><a href="http://www.linkedin.com/profile/view?id=140036254" target="_blank">LinkedIn</a></li>
                </ul>
            </div>
        </footer>
        
    </body>
</html>